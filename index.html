<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© + Ø§Ù„Ø­Ø°Ù</title>
    
    <style>
        /* ==================================== */
        /* CSS: Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ */
        /* ==================================== */
        :root {
            --primary-color: #007bff; 
            --secondary-color: #6c757d; 
            --success-color: #28a745; 
            --danger-color: #dc3545; 
            --bg-light: #f8f9fa; 
            --text-dark: #343a40; 
        }
        
        body { 
            font-family: 'Tahoma', 'Arial', sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: var(--bg-light);
            color: var(--text-dark);
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 30px;
            background-color: #fff;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-radius: 12px;
        }
        h1, h2, h3 { 
            color: var(--primary-color); 
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        nav {
            background-color: var(--primary-color);
            padding: 10px 0;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        nav a { 
            margin: 0 15px; 
            text-decoration: none; 
            color: white; 
            font-weight: bold;
            padding: 8px 12px;
            transition: background-color 0.3s, border-radius 0.3s;
        }
        nav a:hover, nav a.active-link {
            background-color: #0056b3;
            border-radius: 6px;
        }

        /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
            font-size: 14px;
        }
        th, td { 
            border: 1px solid #dee2e6; 
            padding: 12px; 
            text-align: right; 
        }
        th { 
            background-color: var(--bg-light); 
            color: var(--text-dark);
            font-weight: bold;
        }
        tr:nth-child(even) { background-color: #f8f9fa; }
        .deposit { color: var(--success-color); font-weight: bold; }
        .expense { color: var(--danger-color); font-weight: bold; }
        .tab-content { display: none; padding-top: 20px; }
        .active { display: block; }
        
        /* Ø§Ù„Ù…Ù„Ø®Øµ */
        #summary-data { display: flex; justify-content: space-between; gap: 20px; }
        #summary-data p {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            flex-grow: 1;
            border-right: 5px solid var(--primary-color);
            white-space: nowrap;
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø§Ù…Ø© */
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            color: white;
            font-weight: bold;
        }
        .btn-edit { background-color: #ffc107; color: var(--text-dark); margin-right: 5px; }
        .btn-edit:hover { background-color: #e0a800; }
        .btn-delete { background-color: var(--danger-color); color: white; margin-right: 5px; }
        .btn-delete:hover { background-color: #c82333; }
        .action-cell { white-space: nowrap; }

        /* Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ (Modal) */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 100; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.4); 
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: right;
        }
        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-content label { display: inline-block; width: 120px; margin-top: 10px; }
        .modal-content input, .modal-content select { 
            width: 65%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø¥ÙŠØ¬Ø§Ø±Ø§Øª ÙˆÙ…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª (25 Ø´Ù‚Ø©)</h1>

    <nav id="main-nav">
        <a href="#dashboard" class="active-link" onclick="showTab('dashboard', this)">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©/Ø§Ù„Ù…Ù„Ø®Øµ</a>
        <a href="#transactions" onclick="showTab('transactions', this)">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</a>
        <a href="#statements" onclick="showTab('statements', this)">ÙƒØ´ÙˆÙØ§Øª Ø§Ù„Ø­Ø±ÙƒØ©</a>
        <a href="#reports" onclick="showTab('reports', this)">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</a>
    </nav>

    <section id="dashboard" class="tab-content active">
        <h2>Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø§Ù„ÙŠ</h2>
        <div id="summary-data">
            <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª:</strong> <span id="total-deposits">0.00</span> Ø±ÙŠØ§Ù„</p>
            <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª:</strong> <span id="total-expenses">0.00</span> Ø±ÙŠØ§Ù„</p>
            <p><strong>ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„ (Ø§Ù„Ø±ØµÙŠØ¯):</strong> <span id="net-income">0.00</span> Ø±ÙŠØ§Ù„</p>
        </div>
        <h3 style="margin-top: 40px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù‡Ø§Ù…Ø©</h3>
        <p>ğŸ”´ **ØªØ°ÙƒÙŠØ±:** Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ù…ØªØµÙØ­Ùƒ. Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ù…ØªØµÙØ­ ÙˆØ§Ù„Ø¬Ù‡Ø§Ø² Ù„ØªØ¬Ù†Ø¨ Ø¶ÙŠØ§Ø¹Ù‡Ø§. ÙŠØ±Ø¬Ù‰ **Ø¹Ø¯Ù…** Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ¶Ø¹ Ø§Ù„ØªØµÙØ­ Ø§Ù„Ø®ÙÙŠ (Incognito Mode).</p>
    </section>

    <section id="transactions" class="tab-content">
        <h2>Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù…Ù„ÙŠØ© Ù…Ø§Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h2>
        <h3>Ø¥Ø¯Ø®Ø§Ù„ Ø¥ÙŠØ¯Ø§Ø¹ (Ø¥ÙŠØ¬Ø§Ø±) ğŸ’°</h3>
        <form id="deposit-form">
            <label for="dep-date">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
            <input type="date" id="dep-date" required><br>

            <label for="dep-amount">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</label>
            <input type="number" id="dep-amount" min="1" required><br>
            
            <label for="dep-payment-method">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</label>
            <select id="dep-payment-method" required>
                <option value="Ù†Ù‚Ø¯ÙŠ">Ù†Ù‚Ø¯ÙŠ (Cash)</option>
                <option value="Ø¨Ù†ÙƒÙŠ">ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ (Bank Transfer)</option>
            </select><br>

            <label for="dep-building">Ø§Ù„Ø¹Ù‚Ø§Ø± (Ø§Ù„Ù…Ø¨Ù†Ù‰):</label>
            <select id="dep-building" onchange="populateUnits()" required>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù‚Ø§Ø± --</option>
                <option value="Ø§Ù„ÙÙŠÙ„Ø§ ÙˆØ§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">Ø§Ù„ÙÙŠÙ„Ø§ ÙˆØ§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø´Ù‚Ù‚ 1-14)</option>
                <option value="Ø§Ù„Ù…Ø¬Ù„Ø³ 101">Ø§Ù„Ù…Ø¬Ù„Ø³ 101 (Ø´Ù‚Ù‚ 15-21)</option>
                <option value="Ø§Ù„Ù…Ø¬Ù„Ø³ 102">Ø§Ù„Ù…Ø¬Ù„Ø³ 102 (Ø´Ù‚Ù‚ 22-25)</option>
            </select><br>

            <label for="dep-unit">Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø©/Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
            <select id="dep-unit" required disabled>
                <option value="">-- Ø§Ø®ØªØ± Ø´Ù‚Ø© --</option>
            </select><br>

            <label for="dep-desc">Ù…Ù„Ø§Ø­Ø¸Ø§Øª/Ø§Ù„Ø´Ù‡Ø±:</label>
            <input type="text" id="dep-desc" placeholder="Ù…Ø«Ø§Ù„: Ø¥ÙŠØ¬Ø§Ø± Ø´Ù‡Ø± Ø£ÙƒØªÙˆØ¨Ø± 2025"><br>

            <button type="submit" style="background-color: var(--success-color);">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</button>
        </form>

        <hr style="margin: 30px 0;">

        <h3>Ø¥Ø¯Ø®Ø§Ù„ Ù…ØµØ±ÙˆÙ ğŸ’¸</h3>
        <form id="expense-form">
            <label for="exp-date">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
            <input type="date" id="exp-date" required><br>

            <label for="exp-amount">Ø§Ù„Ù…Ø¨Ù„Øº:</label>
            <input type="number" id="exp-amount" min="1" required><br>

            <label for="exp-type">Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ:</label>
            <select id="exp-type" required>
                <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
                <option value="ÙÙˆØ§ØªÙŠØ±">ÙÙˆØ§ØªÙŠØ± (ÙƒÙ‡Ø±Ø¨Ø§Ø¡/Ù…Ø§Ø¡)</option>
                <option value="Ø£Ø¬ÙˆØ±">Ø£Ø¬ÙˆØ± Ø­Ø§Ø±Ø³/Ø¥Ø¯Ø§Ø±Ø©</option>
                <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
            </select><br>

            <label for="exp-desc">Ø§Ù„ÙˆØµÙ:</label>
            <input type="text" id="exp-desc" required placeholder="Ù…Ø«Ø§Ù„: ÙØ§ØªÙˆØ±Ø© ÙƒÙ‡Ø±Ø¨Ø§Ø¡ Ø§Ù„ÙÙŠÙ„Ø§"><br>

            <button type="submit" style="background-color: var(--danger-color);">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
        </form>
    </section>

    <section id="statements" class="tab-content">
        <h2>ÙƒØ´Ù Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h2>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                    <th>Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                    <th>Ø§Ù„ÙˆØ­Ø¯Ø©/Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                    <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
                    <th>Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ (+)</th>
                    <th>Ø§Ù„Ù…ØµØ±ÙˆÙ (-)</th>
                    <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="transactions-table-body">
                <tr><td colspan="9" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</td></tr>
            </tbody>
        </table>
    </section>

    <section id="reports" class="tab-content">
        <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©</h2>
        
        <div class="report-controls">
            <label for="report-type">Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</label>
            <select id="report-type" onchange="toggleReportFilters()">
                <option value="annual">ØªÙ‚Ø±ÙŠØ± Ø³Ù†ÙˆÙŠ/Ø´Ù‡Ø±ÙŠ Ø¥Ø¬Ù…Ø§Ù„ÙŠ</option>
                <option value="building">ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±</option>
            </select>
            
            <div id="filter-building" style="margin-top: 15px; display: none;">
                <label for="report-building-select">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù‚Ø§Ø±:</label>
                <select id="report-building-select">
                    <option value="Ø§Ù„ÙƒÙ„">Ø§Ù„ÙƒÙ„</option>
                    <option value="Ø§Ù„ÙÙŠÙ„Ø§ ÙˆØ§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">Ø§Ù„ÙÙŠÙ„Ø§ ÙˆØ§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</option>
                    <option value="Ø§Ù„Ù…Ø¬Ù„Ø³ 101">Ø§Ù„Ù…Ø¬Ù„Ø³ 101</option>
                    <option value="Ø§Ù„Ù…Ø¬Ù„Ø³ 102">Ø§Ù„Ù…Ø¬Ù„Ø³ 102</option>
                </select>
            </div>
            
            <button onclick="generateReport()" style="margin-right: 20px; background-color: #17a2b8;">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            <button onclick="printReport()" style="background-color: var(--secondary-color);">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </div>

        <h3 id="report-title">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
        <div id="report-output">
            <p style="color: var(--secondary-color);">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙˆØ§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>
        </div>
    </section>

</div> <div id="editModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h2>
        <form id="edit-form">
            <input type="hidden" id="edit-id">

            <label for="edit-date">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
            <input type="date" id="edit-date" required><br>

            <label for="edit-amount">Ø§Ù„Ù…Ø¨Ù„Øº (Ù…ÙˆØ¬Ø¨ Ù„Ù„Ø¥ÙŠØ¯Ø§Ø¹ØŒ Ø³Ø§Ù„Ø¨ Ù„Ù„Ù…ØµØ±ÙˆÙ):</label>
            <input type="number" id="edit-amount" required><br>

            <label for="edit-desc">Ø§Ù„ÙˆØµÙ/Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
            <input type="text" id="edit-desc" required><br>
            
            <button type="submit" style="background-color: var(--primary-color);">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
        </form>
    </div>
</div>

<script>
    const unitsMap = {
        "Ø§Ù„ÙÙŠÙ„Ø§ ÙˆØ§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14],    
        "Ø§Ù„Ù…Ø¬Ù„Ø³ 101": [15, 16, 17, 18, 19, 20, 21], 
        "Ø§Ù„Ù…Ø¬Ù„Ø³ 102": [22, 23, 24, 25] 
    };
    let transactions = []; 

    // ===================================
    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ§Ù„Ø­Ø³Ø§Ø¨
    // ===================================

    function loadTransactions() {
        const storedTransactions = localStorage.getItem('hesabatTransactions');
        if (storedTransactions) {
            transactions = JSON.parse(storedTransactions);
        }
        updateSummary();
    }

    function saveTransactions() {
        localStorage.setItem('hesabatTransactions', JSON.stringify(transactions));
    }

    function updateSummary() {
        let totalDeposits = 0;
        let totalExpenses = 0;
        let netIncome = 0;

        transactions.forEach(t => {
            if (t.amount > 0) {
                totalDeposits += t.amount;
            } else {
                totalExpenses += Math.abs(t.amount); 
            }
            netIncome += t.amount;
        });
        
        document.getElementById('total-deposits').textContent = totalDeposits.toFixed(2).toLocaleString('en');
        document.getElementById('total-expenses').textContent = totalExpenses.toFixed(2).toLocaleString('en');
        document.getElementById('net-income').textContent = netIncome.toFixed(2).toLocaleString('en');
        
        const netIncomeElement = document.getElementById('net-income');
        const successColor = getComputedStyle(document.documentElement).getPropertyValue('--success-color');
        const dangerColor = getComputedStyle(document.documentElement).getPropertyValue('--danger-color');

        netIncomeElement.style.color = netIncome >= 0 ? successColor : dangerColor;
    }

    // ===================================
    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    // ===================================
    function deleteTransaction(id) {
        const transactionIndex = transactions.findIndex(t => t.id === id);

        if (transactionIndex > -1) {
            const transactionType = transactions[transactionIndex].type;
            const confirmation = confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${transactionType} Ø¨ØªØ§Ø±ÙŠØ® ${transactions[transactionIndex].date}ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.`);
            
            if (confirmation) {
                transactions.splice(transactionIndex, 1); // Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
                saveTransactions();
                updateSummary();
                renderTransactions();
                alert('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ØŒ Ø¨Ø³ Ù„Ø§ ØªÙ†Ø³Ù‰ .');
            }
        } else {
            alert('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡Ø§.');
        }
    }


    // ===================================
    // Ø¹Ø±Ø¶ ÙƒØ´Ù Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Ù…ÙØ­Ø¯Ø«)
    // ===================================

    function renderTransactions() {
        const tableBody = document.getElementById('transactions-table-body');
        tableBody.innerHTML = ''; 

        if (transactions.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</td></tr>';
            return;
        }

        const sortedTransactions = [...transactions].sort((a, b) => {
            if (a.date < b.date) return -1;
            if (a.date > b.date) return 1;
            return a.id - b.id; 
        });
        
        let runningBalance = 0;
        let rowsHtml = [];
        
        const successColor = getComputedStyle(document.documentElement).getPropertyValue('--success-color');
        const dangerColor = getComputedStyle(document.documentElement).getPropertyValue('--danger-color');

        sortedTransactions.forEach(t => {
            runningBalance += t.amount;

            const depositValue = t.amount > 0 ? t.amount.toFixed(2).toLocaleString('en') : '-';
            const expenseValue = t.amount < 0 ? Math.abs(t.amount).toFixed(2).toLocaleString('en') : '-';
            const unitDisplay = t.type === 'Ø¥ÙŠØ¯Ø§Ø¹' ? `Ø´Ù‚Ø© ${t.unit}` : t.unit;
            
            rowsHtml.push(`
                <tr>
                    <td>${t.date}</td>
                    <td>${t.type}</td>
                    <td>${t.building}</td>
                    <td>${unitDisplay} / ${t.description}</td>
                    <td>${t.paymentMethod || '-'}</td>
                    <td class="${t.amount > 0 ? 'deposit' : ''}">${depositValue}</td>
                    <td class="${t.amount < 0 ? 'expense' : ''}">${expenseValue}</td>
                    <td style="font-weight: bold; color: ${runningBalance >= 0 ? successColor : dangerColor};">${runningBalance.toFixed(2).toLocaleString('en')}</td>
                    <td class="action-cell">
                        <button class="btn-edit" onclick="openModal(${t.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn-delete" onclick="deleteTransaction(${t.id})">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `);
        });
        
        // Ø¹ÙƒØ³ ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„ÙŠÙƒÙˆÙ† Ø§Ù„Ø£Ø­Ø¯Ø« Ù‡Ùˆ Ø§Ù„Ø£Ø¹Ù„Ù‰
        tableBody.innerHTML = rowsHtml.reverse().join('');
    }
    
    // ===================================
    // ÙˆØ¸Ø§Ø¦Ù Ø¯Ø¹Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    // ===================================
    
    function showTab(tabId, element) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        document.getElementById(tabId).classList.add('active');

        document.querySelectorAll('nav a').forEach(a => {
            a.classList.remove('active-link');
        });
        element.classList.add('active-link');
        
        if (tabId === 'statements') {
            renderTransactions(); 
        }
        if (tabId === 'dashboard') {
            updateSummary(); 
        }
        if (tabId === 'reports') {
            toggleReportFilters();
        }
    }

    function populateUnits() {
        const buildingSelect = document.getElementById('dep-building');
        const unitSelect = document.getElementById('dep-unit');
        const selectedBuilding = buildingSelect.value;

        unitSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø´Ù‚Ø© --</option>';

        if (selectedBuilding && unitsMap[selectedBuilding]) {
            unitSelect.disabled = false;
            const units = unitsMap[selectedBuilding];

            units.forEach(unitNumber => {
                const option = document.createElement('option');
                option.value = unitNumber;
                option.textContent = `Ø´Ù‚Ø© Ø±Ù‚Ù… ${unitNumber}`;
                unitSelect.appendChild(option);
            });
        } else {
            unitSelect.disabled = true;
        }
    }
    
    // ===================================
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
    // ===================================

    document.getElementById('deposit-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const newTransaction = {
            date: document.getElementById('dep-date').value,
            type: 'Ø¥ÙŠØ¯Ø§Ø¹',
            amount: parseFloat(document.getElementById('dep-amount').value),
            paymentMethod: document.getElementById('dep-payment-method').value, 
            building: document.getElementById('dep-building').value,
            unit: document.getElementById('dep-unit').value,
            description: document.getElementById('dep-desc').value || 'Ø¥ÙŠØ¬Ø§Ø± Ù…Ø¯ÙÙˆØ¹',
            id: Date.now() 
        };

        transactions.push(newTransaction);
        saveTransactions();
        updateSummary();
        this.reset();
        alert('âœ…  ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­ ÙŠØ§ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø¨Ø·Ù„ !');
        document.getElementById('dep-unit').disabled = true; 
    });

    document.getElementById('expense-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const newTransaction = {
            date: document.getElementById('exp-date').value,
            type: 'Ù…ØµØ±ÙˆÙ',
            amount: parseFloat(document.getElementById('exp-amount').value) * -1, 
            paymentMethod: 'Ù†Ù‚Ø¯ÙŠ/ØºÙŠØ± Ù…Ø­Ø¯Ø¯', 
            building: 'Ù…ØµØ±ÙˆÙØ§Øª',
            unit: document.getElementById('exp-type').value, 
            description: document.getElementById('exp-desc').value,
            id: Date.now()
        };

        transactions.push(newTransaction);
        saveTransactions();
        updateSummary();
        this.reset();
        alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­!');
    });


    // ===================================
    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Editing)
    // ===================================
    
    function openModal(id) {
        const transaction = transactions.find(t => t.id === id);
        if (!transaction) return;

        document.getElementById('edit-id').value = id;
        document.getElementById('edit-date').value = transaction.date;
        document.getElementById('edit-amount').value = transaction.amount; 
        document.getElementById('edit-desc').value = transaction.description;

        document.getElementById('editModal').style.display = "block";
    }

    function closeModal() {
        document.getElementById('editModal').style.display = "none";
    }

    document.getElementById('edit-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const idToEdit = parseFloat(document.getElementById('edit-id').value);
        const newDate = document.getElementById('edit-date').value;
        const newAmount = parseFloat(document.getElementById('edit-amount').value);
        const newDesc = document.getElementById('edit-desc').value;

        const transactionIndex = transactions.findIndex(t => t.id === idToEdit);

        if (transactionIndex > -1) {
            const originalType = transactions[transactionIndex].type;
            
            transactions[transactionIndex].date = newDate;
            transactions[transactionIndex].amount = newAmount; 
            transactions[transactionIndex].description = newDesc;
            
            if (originalType === 'Ø¥ÙŠØ¯Ø§Ø¹' && newAmount < 0) {
                 transactions[transactionIndex].type = 'Ù…ØµØ±ÙˆÙ';
                 transactions[transactionIndex].building = 'Ù…ØµØ±ÙˆÙØ§Øª';
            } else if (originalType === 'Ù…ØµØ±ÙˆÙ' && newAmount > 0) {
                 transactions[transactionIndex].type = 'Ø¥ÙŠØ¯Ø§Ø¹';
                 transactions[transactionIndex].building = 'ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø© (Ø¥ÙŠØ¯Ø§Ø¹)'; 
            }

            saveTransactions();
            updateSummary();
            renderTransactions();
            closeModal();
            alert('âœ… ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ù†Ù‰/Ø§Ù„ÙˆØ­Ø¯Ø© Ø¥Ø°Ø§ ØªÙ… ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¬Ø°Ø±ÙŠØ§Ù‹.');
        } else {
            alert('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.');
        }
    });

    window.onclick = function(event) {
        const modal = document.getElementById('editModal');
        if (event.target == modal) {
            closeModal();
        }
    }
    
    // ===================================
    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (ÙƒÙ…Ø§ Ù‡ÙŠ)
    // ===================================

    function toggleReportFilters() {
        const type = document.getElementById('report-type').value;
        document.getElementById('filter-building').style.display = type === 'building' ? 'block' : 'none';
    }

    function generateReport() {
        const reportType = document.getElementById('report-type').value;
        const output = document.getElementById('report-output');
        const title = document.getElementById('report-title');
        output.innerHTML = '';
        
        if (transactions.length === 0) {
            output.innerHTML = '<p style="color: red;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±.</p>';
            return;
        }

        if (reportType === 'annual') {
            title.textContent = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù†ÙˆÙŠ/Ø§Ù„Ø´Ù‡Ø±ÙŠ';
            output.innerHTML = generateAnnualReport();
        } else if (reportType === 'building') {
            const selectedBuilding = document.getElementById('report-building-select').value;
            title.textContent = `ØªÙ‚Ø±ÙŠØ± Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø§Ø±: ${selectedBuilding}`;
            output.innerHTML = generateBuildingReport(selectedBuilding);
        }
    }

    function generateAnnualReport() {
        const monthlyData = {};
        transactions.forEach(t => {
            const monthYear = t.date.substring(0, 7); 
            if (!monthlyData[monthYear]) {
                monthlyData[monthYear] = { deposits: 0, expenses: 0, net: 0 };
            }
            if (t.amount > 0) {
                monthlyData[monthYear].deposits += t.amount;
            } else {
                monthlyData[monthYear].expenses += Math.abs(t.amount);
            }
            monthlyData[monthYear].net += t.amount;
        });

        const successColor = getComputedStyle(document.documentElement).getPropertyValue('--success-color');
        const dangerColor = getComputedStyle(document.documentElement).getPropertyValue('--danger-color');

        let html = '<table><thead><tr><th>Ø§Ù„Ø´Ù‡Ø±/Ø§Ù„Ø³Ù†Ø©</th><th>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th><th>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</th><th>ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„</th></tr></thead><tbody>';
        
        const sortedMonths = Object.keys(monthlyData).sort();

        sortedMonths.forEach(month => {
            const data = monthlyData[month];
            html += `
                <tr>
                    <td>${month}</td>
                    <td>${data.deposits.toFixed(2).toLocaleString('en')}</td>
                    <td>${data.expenses.toFixed(2).toLocaleString('en')}</td>
                    <td style="color: ${data.net >= 0 ? successColor : dangerColor}; font-weight: bold;">${data.net.toFixed(2).toLocaleString('en')}</td>
                </tr>
            `;
        });

        html += '</tbody></table>';
        return html;
    }

    function generateBuildingReport(building) {
        let filteredTransactions = transactions;
        if (building !== 'Ø§Ù„ÙƒÙ„') {
            filteredTransactions = transactions.filter(t => t.building === building);
        }
        
        let totalDeposits = 0;
        let totalExpenses = 0;

        filteredTransactions.forEach(t => {
            if (t.amount > 0) totalDeposits += t.amount;
            else totalExpenses += Math.abs(t.amount);
        });

        const successColor = getComputedStyle(document.documentElement).getPropertyValue('--success-color');
        const dangerColor = getComputedStyle(document.documentElement).getPropertyValue('--danger-color');

        let html = `
            <p><strong>ØµØ§ÙÙŠ Ø§Ù„Ø¯Ø®Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø§Ø±:</strong> ${(totalDeposits - totalExpenses).toFixed(2).toLocaleString('en')} Ø±ÙŠØ§Ù„</p>
            <p style="color: ${successColor};">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª: ${totalDeposits.toFixed(2).toLocaleString('en')} Ø±ÙŠØ§Ù„</p>
            <p style="color: ${dangerColor};">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${totalExpenses.toFixed(2).toLocaleString('en')} Ø±ÙŠØ§Ù„</p>
        `;

        if (building !== 'Ø§Ù„ÙƒÙ„') {
            const unitPerformance = {};
            filteredTransactions.filter(t => t.type === 'Ø¥ÙŠØ¯Ø§Ø¹').forEach(t => {
                const unitKey = t.unit;
                if (!unitPerformance[unitKey]) {
                    unitPerformance[unitKey] = 0;
                }
                unitPerformance[unitKey] += t.amount;
            });

            html += '<h3>Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ­Ø¯Ø§Øª (Ø§Ù„Ø´Ù‚Ù‚)</h3>';
            html += '<table><thead><tr><th>Ø§Ù„Ø´Ù‚Ø©</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</th></tr></thead><tbody>';
            
            Object.keys(unitPerformance).sort((a, b) => a - b).forEach(unit => {
                html += `
                    <tr>
                        <td>Ø´Ù‚Ø© Ø±Ù‚Ù… ${unit}</td>
                        <td>${unitPerformance[unit].toFixed(2).toLocaleString('en')}</td>
                    </tr>
                `;
            });
            html += '</tbody></table>';
        }
        
        return html;
    }
    
    function printReport() {
        const reportContent = document.getElementById('report-output').innerHTML;
        const title = document.getElementById('report-title').textContent;
        const printWindow = window.open('', '', 'height=600,width=800');
        printWindow.document.write('<html><head><title>' + title + '</title>');
        printWindow.document.write('<style>body { font-family: Arial, sans-serif; direction: rtl; text-align: right; } table { width: 100%; border-collapse: collapse; margin-top: 20px; } th, td { border: 1px solid #000; padding: 8px; text-align: right; } th { background-color: #f2f2f2; } </style>');
        printWindow.document.write('</head><body>');
        printWindow.document.write('<h1>' + title + '</h1>');
        printWindow.document.write(reportContent);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.print();
    }


    // 11. ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = function() {
        loadTransactions();
        showTab('dashboard', document.querySelector('nav a:first-child')); 
    };
</script>

</body>
</html>
